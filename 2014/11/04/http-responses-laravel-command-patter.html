<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>How to handle the HTTP responses in Laravel using Command Pattern | KEEVITAJA</title>
        <meta name="description" content="Tutorial on how to handle the HTTP responses in Laravel using Command Pattern.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="/css/app.css">
    </head>
    <body>
        <header class="main-header">
            <nav class="mobile-navigation" data-navigation-type="container">

            </nav> <!-- .mobile-navigation -->

            <nav class="primary-navigation">
                    <ul class="container-wide" data-navigation-type="source">
                        
                            <li><a href="/tags#General">General</a></li>
                        
                            <li><a href="/tags#Patterns">Patterns</a></li>
                        
                            <li><a href="/tags#Laravel">Laravel</a></li>
                        
                            <li><a href="/tags#Editors">Editors</a></li>
                        
                    </ul>
            </nav> <!-- .primary-navigation -->

            <div class="container-wide">
                <h1 class="site-name"><a href="/">KEEVITAJA</a></h1>

                <nav class="secondary-navigation">
                    <ul data-navigation-type="source">
                        
                            
                                
                                    <li><a href="/about/">About</a></li>
                                
                            
                        
                            
                        
                            
                        
                            
                                
                                    <li><a href="/tags/">Tags</a></li>
                                
                            
                        
                    </ul>
                </nav> <!-- .secondary-navigation -->

                <a href="#" class="mobile-button" data-navigation-type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </a>
            </div> <!-- .container-wide -->
        </header> <!-- .main-header -->

        <main class="main-content container-narrow">
            <article class="main-article">
    <header class="article-header">
        <span class="stats">
            04 November 2014 
            
                <a href="/tags#Laravel" class="tag">Laravel</a>
            
                <a href="/tags#Patterns" class="tag">Patterns</a>
            
        </span>

        <h1 class="article-title"><a href="/2014/11/04/http-responses-laravel-command-patter.html">How to handle the HTTP responses in Laravel using Command Pattern</a></h1>
    </header> <!-- .article-header -->

    <div class="article-content">
        

<p>There are many ways to handle the <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP responses</a>. It all comes down to a personal preference. One cool way to go is a solution where we use a <a href="http://php.net/manual/en/language.oop5.constants.php">class constant</a> as the status from the <a href="https://laracasts.com/series/commands-and-domain-events/episodes/2">Command Bus</a>. Then we select the correct response using the status and return it.  </p>

<p>The benefit of taking this approach is highly readable code which gives us more flexibility than just using a boolean or a string.</p>

<blockquote>
  <p>The following solution can also be used without the Command Pattern. For the example a Service may return this type of status!</p>
</blockquote>

<p>The goal is to store the status as a constant inside a dedicated class. Class constant is not required to have a value, but it makes sense to assign <a href="http://laravel.com/docs/master/localization">i18n</a> slug to it. We will see the huge benefit in the Controller class!</p>

<pre><code>class DrinkBeerCommandStatus {

    const BOTTLE_EMPTY = 'responses.bottle.empty';
    const SUBJECT_DRUNK = 'responses.subject.drunk';
    const SNACKS_MISSING = 'responses.snacks.missing';
}
</code></pre>

<p>In the Command Handler we do our tasks, fire events and finally return the appropriate status.</p>

<pre><code>class DrinkBeerCommandHandler {

    public function handle($command)
    {
        try
        {
            $this-&gt;drink($command-&gt;subject);
        }
        catch (BottleException $e)
        {
            return DrinkBeerCommandStatus::BOTTLE_EMPTY;
        }
        catch (FoodException $e)
        {
            return DrinkBeerCommandStatus::SNACKS_MISSING;
        }
        
        return DrinkBeerCommandStatus::SUBJECT_DRUNK;
    }
}
</code></pre>

<p>In each case we get the correct status from the handler executed by the Command Bus. Again there are many ways how to proceed, but using the status inside a switch statement gives us the maximum amount of benefit we can get!</p>

<pre><code>class DrinkingController {

    public function drink()
    {
        $status = $this-&gt;commandBus-&gt;execute($command);

        switch ($status)
        {
            case DrinkBeerCommandStatus::BOTTLE_EMPTY:
            case DrinkBeerCommandStatus::SNACKS_MISSING:
                return redirect('seek')-&gt;withMessage(trans($status));
            case DrinkBeerCommandStatus::SUBJECT_DRUN:
                return redirect('sleep');

        }
    }
}
</code></pre>

<p>Using a class constant as the status with a i18n slug assigned to it, gives us huge flexibility with highly readable code. There are no comments needed! If the bottle was empty or there were no snacks, we need to seek for new resources. If we drank lot of beer it is time to sleep!</p>

<p>The pseudo code above uses Laravel 5 helpers.</p>


    </div> <!-- .article-content -->

    <div class="article-comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'keevitaja'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div> <!-- .comments -->
</article> <!-- .main-article -->
        </main> <!-- .main-content -->

        <footer class="main-footer">
            <ul class="container-wide">
                <li><a href="http://twitter.com/keevitaja">Twitter</a></li>
                <li><a href="http://github.com/keevitaja">Github</a></li>
            </ul>
        </footer> <!-- .main-footer -->

        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56314956-1', 'auto');
  ga('send', 'pageview');

</script>
        <script src="/js/app.js"></script>
    </body>
</html>